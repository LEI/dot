version: "2"

services:
  test:
    image: lei/dot
    depends_on:
      - image
    entrypoint: /bin/bash
    command: |
      -l -c 'run() { printf "%s\n" "TEST: $$*"; "$$@" || exit 1; }
      tail_bashrc="$$(tail -n1 ~/.bashrc)"
      run dot -p bash=LEI/dot-bash
      [[ "$$(tail -n1 ~/.bashrc)" != "$$tail_bashrc" ]] || exit 1
      run test -d "$$HOME/.bash.d"'
