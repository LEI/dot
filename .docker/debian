# vi: ft=Dockerfile
FROM debian

ENV OS linux
ENV ARCH amd64
ENV USER docker
ENV DEBIAN_FRONTEND noninteractive

RUN apt-get update -qq -y && \
apt-get install -qq --no-install-suggests --no-install-recommends -y \
apt-utils \
ca-certificates \
git \
locales \
sudo

RUN sed -i -e 's/# en_GB.UTF-8 UTF-8/en_GB.UTF-8 UTF-8/' /etc/locale.gen && \
locale-gen
ENV LANG en_GB.UTF-8
ENV LANGUAGE en_GB:en
ENV LC_ALL en_GB.UTF-8

COPY ./dist/${OS}_${ARCH}/dot /usr/local/bin/dot

RUN useradd --create-home --shell /bin/bash $USER
RUN echo "$USER:$USER" | chpasswd
RUN echo '%sudo ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers.d/sudo
RUN adduser $USER sudo && adduser $USER staff

USER $USER

WORKDIR /home/$USER

COPY ./scripts scripts
COPY ./.dot.yml .dot.yml

# Restore interactive
ENV DEBIAN_FRONTEND newt

#RUN dot install --packages --sudo

ENTRYPOINT ["/bin/bash"]
