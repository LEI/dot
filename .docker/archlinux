# vi: ft=Dockerfile
FROM base/archlinux

ENV OS linux
ENV ARCH amd64
ENV USER docker

RUN pacman -Syu --needed --noconfirm --noprogressbar --quiet \
base-devel \
ca-certificates \
git \
sudo

RUN sed -i -e 's/#en_GB.UTF-8 UTF-8/en_GB.UTF-8 UTF-8/' /etc/locale.gen && \
locale-gen
ENV LANG en_GB.UTF-8
ENV LANGUAGE en_GB:en
ENV LC_ALL en_GB.UTF-8

RUN groupadd sudo
RUN ./scripts/setup-user.sh --groups sudo --password '' $USER

COPY ./dist/${OS}_${ARCH}/dot /usr/local/bin/dot

USER $USER

WORKDIR /home/$USER

COPY ./scripts scripts
COPY ./.dot.yml .dot.yml

#RUN dot install --packages --sudo

ENTRYPOINT ["/bin/bash"]
