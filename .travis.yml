sudo: required
#group: deprecated-2017Q2

language: go

# go:
#   - master

os:
  - linux
  # - osx # brew install docker-compose

services:
  - docker

stages:
  - compile
  - test
  # - name: deploy
  #   if: branch = latest

jobs:
  include:
    - stage: compile
      before_script:
        - sudo apt-get -qq update
        # - sudo apt-get install -y vim tmux
        - go get github.com/sirupsen/logrus
        - go get github.com/spf13/cobra
        - go get github.com/spf13/viper
        # - go get github.com/mattn/goveralls
      script:
        # - golint
        - go vet ./...
        - go test -v ./... # -covermode=count -coverprofile=coverage.out
        # - go install
        # - yes | dot --https
        # # - curl -sfLo ~/.vim/autoload/plug.vim --create-dirs 'https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
        # - tmux new-session -n test "vim -E -s -u $HOME/.vim/vimrc +PlugInstall +qall; exit"
        # - test -d $HOME/.tmux/plugins/tpm
        # - test -d $HOME/.vim/plugged
        # - goveralls -coverprofile=coverage.out -service=travis-ci -repotoken $COVERALLS_TOKEN
    - stage: test
      before_script:
        - docker-compose build
      script:
        # - "for t in tests/docker-compose.*.yml; do docker-compose -f docker-compose.yml -f $t run test; done"
        - docker-compose run test
    # - stage: deploy
    #     before_deploy:
    #       - GOOS=windows GOARCH=amd64 go build -o ci-test-windows-amd64.exe
    #       - GOOS=linux   GOARCH=amd64 go build -o ci-test-linux-amd64
    #     deploy:
    #       provider: releases
    #       api_key: "GITHUB OAUTH TOKEN"
    #       file: "FILE TO UPLOAD"
    #       skip_cleanup: true
    #       on:
    #         tags: true

notifications:
  email: false
